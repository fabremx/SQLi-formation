<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ThewayShop - Fresh Fruits and Vegetables</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/login.css">

    <script type="module" src="./components/header.js"></script>
    <script type="module" src="./components/footer.js"></script>
</head>

<body>
    <!-- Code in components/header.js  -->
    <header class="main-header"></header>

	<div class="login-page">
		<div class="alert alert-danger alert-dismissible fade show" id="invalid-alert" role="alert">
		  Invalid credentials !
		  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		
		<div class="alert alert-success alert-dismissible fade show" id="success-alert" role="alert">
		  Connection success ! Welcome
		  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		
		<div class="form">
			<form class="login-form">
			  <input type="text" placeholder="username" id="user-input" />
			  <input type="password" placeholder="password" id="password-input"/>
			  <button id="login-btn">login</button>
			  <p class="message">Not registered? <a href="#">Create an account</a></p>
			</form>
		</div>
	</div>

    <!-- Code in components/footer.js  -->
    <footer></footer>

    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.superslides.min.js"></script>
    <script src="js/bootstrap-select.js"></script>
    <script src="js/inewsticker.js"></script>
    <script src="js/bootsnav.js."></script>
    <script src="js/images-loded.min.js"></script>
    <script src="js/isotope.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/baguetteBox.min.js"></script>
    <script src="js/form-validator.min.js"></script>
    <script src="js/contact-form-script.js"></script>
    <script src="js/custom.js"></script>
	
	<script>
		function displayAlertBox(id) {
			document.getElementById(id).style.display = 'block';
			setTimeout(function(){ document.getElementById(id).style.display = 'none'; }, 1700);
        }
        
        async function logIn(event) {
            event.preventDefault();
			var user = document.getElementById("user-input").value;
			var password = document.getElementById("password-input").value;
			
			var headers = new Headers();
			headers.append("Content-Type", "application/json");
            
            try {
                const response = await fetch("http://localhost:3000/login", {
                  method: "POST",
                  headers: headers,
                  body: JSON.stringify({
                    "user": user,
                    "password": password
                  })
                })

                if (response.status !== 200) {
                    displayAlertBox('invalid-alert')
                    return;
                }

                const result = await response.json()
                displayAlertBox('success-alert')
                window.localStorage.setItem("user", result.user.user)
                window.localStorage.setItem("isAdmin", result.user.isAdmin)
                setTimeout(function(){ document.location.replace("index.html") }, 1700);
            } catch(error) {
                displayAlertBox('success-alert')
            }
        }
		
		document.getElementById("login-btn").addEventListener("click", function(event) {logIn(event)});
	</script>
</body>
</html>